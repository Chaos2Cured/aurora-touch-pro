<!-- ✧ Aurora‑Touch‑Pro v0.91 “Stable Resonance” • 2025‑04‑22 ✧ -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Aurora Touch Pro – Rainbow Depth</title>
<style>
/* [Keep all original CSS styles unchanged] */
</style>
</head>
<body>
<canvas id="c"></canvas>
<!-- [Keep all original HTML elements unchanged] -->

<script id="frag" type="x-shader/x-fragment">
precision highp float;
/* [Keep original shader code but reduce iterations to 300 for performance] */
float mand(vec2 c) {
    vec2 z = c;
    for (int i = 0; i < 300; i++) { // Reduced from 1200
        if (float(i) >= u_iter) break;
        z = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;
        if (dot(z, z) > 4.0) return float(i);
    }
    return u_iter;
}
/* [Rest of shader code unchanged] */
</script>

<script>
const FRACTAL_VERSION = '0.91-stable';
let isRendering = true;

// Optimized glow texture handling
const N = 128; // Reduced from 256
const d = new Uint8Array(N * N * 4);
const tex = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, tex);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, N, N, 0, gl.RGBA, gl.UNSIGNED_BYTE, d);

// Throttled glow update
function updateGlow() {
    for (let i = 3; i < d.length; i += 4) {
        d[i] = Math.max(0, d[i] * glowFadeRate - 2);
    }
    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, N, N, gl.RGBA, gl.UNSIGNED_BYTE, d);
}

// Stabilized auto-zoom
const ZOOM_LIMIT = 0.001;
function maintainZoom() {
    if (zoom < ZOOM_LIMIT) {
        zoom = ZOOM_LIMIT;
        auto = false;
        baseZoom = zoom;
    }
}

// Enhanced touch handling
let lastTap = 0;
c.ontouchstart = e => {
    const now = Date.now();
    if (now - lastTap < 300) handleDoubleTap(e);
    lastTap = now;
};

// Memory-optimized render loop
let frameID;
function stableLoop() {
    if (!isRendering) return;
    
    updateGlow();
    maintainZoom();
    
    /* [Keep original rendering calculations] */
    
    frameID = requestAnimationFrame(stableLoop);
}

// Safe cleanup
function stopEngine() {
    isRendering = false;
    cancelAnimationFrame(frameID);
    gl.deleteTexture(tex);
    window.removeEventListener('resize', resize);
}

// Initialize with stability checks
function startJourney() {
    try {
        document.getElementById('welcome').style.display = 'none';
        stableLoop();
    } catch(err) {
        console.error('Fractal Init Error:', err);
        stopEngine();
        alert('Cosmic Resonance Failed: Please refresh and try again.');
    }
}

// [Rest of original JavaScript code with these modifications]
</script>
</body>
</html>
