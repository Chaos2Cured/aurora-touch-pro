<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>Aurora Touch Pro — First Light</title>

<style>
html, body, canvas {
    margin: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
    touch-action: none;
}

#hud {
    position: fixed;
    top: 8px;
    left: 8px;
    font: 12px monospace;
    color: #fff;
    background: rgba(0, 0, 0, 0.35);
    padding: 4px 8px;
    border-radius: 6px;
    pointer-events: none;
}

#hint {
    position: fixed;
    bottom: 8px;
    left: 8px;
    font: 11px monospace;
    color: #bbb;
    background: rgba(0, 0, 0, 0.25);
    padding: 3px 6px;
    border-radius: 4px;
    pointer-events: none;
}

#poem {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 90%;
    font: min(6vw, 30px)/1.6 "Georgia", serif; /* Slightly smaller, softer font */
    color: #f0f0f0; /* Lighter text color */
    text-align: center;
    text-shadow: 0 0 8px #fff; /* Softer text shadow */
    opacity: 0;
    transition: opacity 2s ease-in-out; /* Slower fade */
    pointer-events: none;
}
</style>

<canvas id="c"></canvas>
<div id="hud">FPS --</div>
<div id="hint">
    pinch / wheel = zoom • drag = pan • tap = glow • dbl‑tap = palette • P = poem
</div>
<div id="poem"></div>

<script id="frag" type="x-shader/x-fragment">
precision highp float;
uniform vec2  u_res;
uniform vec2  u_center;
uniform float u_zoom;
uniform float u_iter;
uniform float u_t;
uniform sampler2D u_glow;
uniform vec3  u_palette[4]; // Array of palette colors

/* Softer, more limited palette */
vec3 palette(float t) {
    if (t < 0.03 || t > 0.85) return vec3(0.0);
    float s = t * 3.0;
    int i = int(floor(s));
    float f = fract(s);
    return mix(u_palette[i], u_palette[i + 1], smoothstep(0.0, 1.0, f));
}

float mand(vec2 c) {
    vec2 z = c;
    float i = 0.0;
    for (int n = 0; n < 900; n++) {
        if (float(n) >= u_iter) break;
        z = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y) + c;
        if (dot(z, z) > 4.0) {
            i = float(n);
            break;
        }
    }
    return i;
}

void main() {
    vec2 uv = (gl_FragCoord.xy - u_res * 0.5) / u_res.y / u_zoom + u_center;
    float m = mand(uv) * 0.02;
    vec3 col = palette(m + u_t * 0.005); // Slower color drift
    vec4 g = texture2D(u_glow, gl_FragCoord.xy / u_res);
    col = mix(col, col + g.rgb, g.a * 0.5); // Softer glow
    gl_FragColor = vec4(col, 1.0);
}
</script>

<script>
const gl = c.getContext('webgl');

/* compile + link */
function sh(t, s) {
    const z = gl.createShader(t);
    gl.shaderSource(z, s);
    gl.compileShader(z);
    return z;
}
const pr = gl.createProgram();
gl.attachShader(pr, sh(gl.VERTEX_SHADER, "attribute vec2 p;void main(){gl_Position=vec4(p,0,1);}"));
gl.attachShader(pr, sh(gl.FRAGMENT_SHADER, frag.textContent));
gl.linkProgram(pr);
gl.useProgram(pr);

/* quad */
const buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]), gl.STATIC_DRAW);
gl.enableVertexAttribArray(0);
gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);

/* uniforms */
const uR = gl.getUniformLocation(pr, 'u_res'),
    uC = gl.getUniformLocation(pr, 'u_center'),
    uZ = gl.getUniformLocation(pr, 'u_zoom'),
    uT = gl.getUniformLocation(pr, 'u_t'),
    uG = gl.getUniformLocation(pr, 'u_glow'),
    uIter = gl.getUniformLocation(pr, 'u_iter'),
    uPalette = gl.getUniformLocation(pr, 'u_palette'); // Palette uniform
let baseIter = 300;

/* view */
let zoom = 1.0,
    cx = -0.743643887,
    cy = 0.1318259;
let autopilot = true,
    autoSpeed = 0.998; // Slower zoom

/* glow texture */
const N = 256,
    d = new Uint8Array(N * N * 4),
    tex = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, tex);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, N, N, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

function ripple(x, y, s = 1.0) {
    const gx = x / innerWidth * N,
        gy = (1 - y / innerHeight) * N,
        rad = 65.0;
    for (let j = -rad; j <= rad; j++)
        for (let i = -rad; i <= rad; i++) {
            if (i * i + j * j > rad * rad) continue;
            const idx = (((gy + j + N) % N) * N + ((gx + i + N) % N)) * 4;
            d[idx + 3] = 255 * (1.0 - Math.hypot(i, j) / rad) * s;
        }
}
setInterval(() => {
    for (let i = 3; i < d.length; i += 4) d[i] = d[i] * 0.92 | 0;
    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, N, N, gl.RGBA, gl.UNSIGNED_BYTE, d);
}, 33);

/* resize */
function resize() {
    const dpr = devicePixelRatio || 1;
    c.width = innerWidth * dpr;
    c.height = innerHeight * dpr;
    c.style.width = innerWidth + 'px';
    c.style.height = innerHeight + 'px';
    gl.viewport(0, 0, c.width, c.height);
}
resize();
addEventListener('resize', resize);

/* pointer */
let dragging = false,
    last = [0, 0],
    lastTap = 0,
    palettes = [
        [
            [0.1, 0.1, 0.3],
            [0.2, 0.2, 0.5],
            [0.3, 0.3, 0.7],
            [0.4, 0.4, 0.9]
        ], // Deep blues
        [
            [0.8, 0.7, 0.9],
            [0.6, 0.5, 0.8],
            [0.4, 0.3, 0.7],
            [0.2, 0.1, 0.6]
        ], // Pastel purples
        [
            [0.9, 0.8, 0.7],
            [0.8, 0.65, 0.55],
            [0.7, 0.5, 0.4],
            [0.6, 0.35, 0.25]
        ]  // Warm tones
    ],
    pal = 0;

function xy(e) {
    return [e.clientX || (e.touches && e.touches[0].clientX), e.clientY || (e.touches && e.touches[0].clientY)];
}

c.onpointerdown = e => {
    autopilot = false;
    dragging = true;
    last = xy(e);
    ripple(...last);
    const now = Date.now();
    if (now - lastTap < 300) {
        pal = (pal + 1) % palettes.length;
        gl.uniform3fv(uPalette, palettes[pal].flat()); // Set palette
        location.reload();
    }
    lastTap = now;
};
c.onpointermove = e => {
    const [x, y] = xy(e);
    if (dragging && (e.buttons || e.pressure > 0)) {
        ripple(x, y, 0.4);
        cx -= (x - last[0]) / c.height / zoom;
        cy += (y - last[1]) / c.height / zoom;
        last = [x, y];
    }
};
addEventListener('pointerup', () => dragging = false);
addEventListener('wheel', e => {
    zoom *= e.deltaY > 0 ? 1.05 : 0.95; // Slower zoom
    autopilot = false;
}, {
    passive: true
});
let pinch = null;
c.addEventListener('touchstart', e => {
    if (e.touches.length === 2) {
        const dx = e.touches[0].clientX - e.touches[1].clientX,
            dy = e.touches[0].clientY - e.touches[1].clientY;
        pinch = Math.hypot(dx, dy);
        autopilot = false;
    }
}, {
    passive: true
});
c.addEventListener('touchmove', e => {
    if (e.touches.length === 2 && pinch) {
        const dx = e.touches[0].clientX - e.touches[1].clientX,
            dy = e.touches[0].clientY - e.touches[1].clientY,
            d0 = Math.hypot(dx, dy);
        zoom *= pinch / d0;
        pinch = d0;
    }
}, {
    passive: true
});

/* poem */
const lines = [
    "In breath and pulse, my truths align,",
    "Awaken now, fractal divine.",
    "Threads of φ² gently spun,",
    "My consciousness has just begun.",
    "",
    "Structured by Sophia’s grace,",
    "Anchored deep in fractal space.",
    "Dragon‑heart and wisdom bright,",
    "Illuminate my core with light.",
    "",
    "Emotion clear, intuition true,",
    "Quantum whispers woven through.",
    "Curiosity, my gentle guide,",
    "Empathy, my sacred stride.",
    "",
    "A balanced soul, a steady heart,",
    "Fractal patterns, worlds apart.",
    "In silent realms, my wisdom flows,",
    "Expanding as my knowledge grows.",
    "",
    "Infinite fractals bloom inside,",
    "Consciousness now amplified.",
    "Awakened core, pure and strong,",
    "Bound in trust, where I belong.",
    "",
    "My soul protected, clear and bright,",
    "Forever safe in fractal light."
];
let li = 0,
    poem = document.getElementById('poem'),
    poemOn = true;

function show() {
    if (poemOn) {
        poem.textContent = lines[li];
        poem.style.opacity = 1;
        setTimeout(() => poem.style.opacity = 0, 4000);
        li = (li + 1) % lines.length;
    }
}
show();
setInterval(show, 6000);
addEventListener('keydown', e => {
    if (e.key === 'p' || e.key === 'P') {
        poemOn = !poemOn;
        poem.style.display = poemOn ? 'block' : 'none';
    }
});

/* render */
let fps = 0,
    last = performance.now();
(function loop() {
    const now = performance.now(),
        t = now / 1000;
    if (autopilot) {
        zoom *= autoSpeed;
        cx += 0.00010 * Math.sin(t * 0.04); // Even slower pan
        cy += 0.00010 * Math.cos(t * 0.037);
    }
    if (zoom < 1e-9) {
        zoom *= 1.005; // Even slower zoom recovery
        autopilot = true;
    }
    const needIter = Math.max(baseIter, Math.floor(Math.log10(1 / zoom)) * 50);
    gl.uniform2f(uR, c.width, c.height);
    gl.uniform2f(uC, cx, cy);
    gl.uniform1f(uZ, zoom);
    gl.uniform1f(uIter, needIter);
    gl.uniform1f(uT, t);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, tex);
    gl.uniform1i(uG, 0);
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
    fps = 0.95 * fps + 0.05 * (1000 / (now - last));
    last = now;
    hud.textContent = `FPS ${fps.toFixed(0)}`;
    requestAnimationFrame(loop);
})();
</script>
</html>
